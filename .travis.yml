language: php

services:
    - docker

cache:
    directories:
        - vendor

before_script:
  - docker-compose build --build-arg UID=$(id -u) --build-arg GID=$(id -g)
  - docker-compose run --rm app composer install --no-interaction

script:
  - docker-compose run --rm app vendor/bin/phpcs
  - docker-compose run --rm app vendor/bin/phpunit

after_script:
  - docker-compose run --rm app php vendor/bin/coveralls -v
